<!-- Delegating build script, used by cruisecontrol to build helloworld.
     Note that the basedir is set to the checked out project -->

<project name="build-helloworld" basedir="checkout/helloworld" default="metrics">

	<import file="panopticode/panopticode-imports.xml" />

	<property name="version" value="0.0.1" />
	<property name="project.name" value="helloworld" />

	<path id="classpath">
		<fileset id="javaLibFiles" dir="/home/java/jdk1.6.0_03/">
			<include name="**/**/*.jar"/>
			<include name="**/*.jar"/>
			<include name="*.jar"/>
		</fileset>
		<fileset id="eclipseLibFiles" dir="/home/java/eclipse_3.4/plugins/">
			<include name="**/**/*.jar"/>
			<include name="**/*.jar"/>
			<include name="*.jar"/>
		</fileset>
	</path>

	<!-- Get the latest from SVN -->
	<exec executable="svn">
		<arg line="up"/>
        </exec>

	<target name="clean">
		<delete dir="target" />
	</target>

	<target name="compile">
	        <delete dir="target/classes" />
	        <mkdir dir="target/classes" />

		<!-- Call the target that does everything -->
	        <ant antfile="build.xml" target="clean"/>
	        <ant antfile="build.xml" target="build.sources"/>
	        <ant antfile="build.xml" target="build.jars"/>
	        <ant antfile="build.xml" target="build.update.jar"/>

        	<copy todir="target/classes/">
        	        <fileset dir="${basedir}/@dot" />
	        </copy>

	</target>

	<target name="metrics" depends="clean">

		<panopticode classDir="${basedir}/@dot"
			panopticodeDir="/home/local/cruisecontrol/ccworkingdir/panopticode" 
			projectDir="${basedir}"
			projectName="${project.name}"
			projectVersion="${version}"
			outputDir="${basedir}/target"
			srcDir="${basedir}/src" />
	</target>

	<target name="unit-test">
		<!--
		<javac debug="true" destdir="target/classes">
			<src path="unittest/src"/>
			<classpath>
				<fileset dir="prod" includes="lib/**/*.jar" />
				<fileset dir="unittest" includes="lib/**/*.jar" />

				<pathelement location="target/classes" />
			</classpath>
			<compilerarg value="-Xlint:unchecked" />
		</javac>

		<mkdir dir="target/rawmetrics/xml/junit" />
		<path id="unittest.path">
			<fileset dir="prod" includes="lib/**/*.jar" />
			<fileset dir="unittest" includes="lib/**/*.jar" />
			<pathelement location="target/classes" />
		</path>
		<panopticode-junit unitTestClasspathId="unittest.path"
			outputDir="target">
			<batchtest todir="target/rawmetrics/xml/junit">
				<fileset dir="target/classes" includes="**/*Test.class" />
			</batchtest>
		</panopticode-junit>
		-->
	</target>

	<target name="rasterize-all-reports"
		depends="rasterize-png-reports,rasterize-jpeg-reports,rasterize-tiff-reports"/>

	<target name="rasterize-png-reports">
		<delete dir="target/reports/png" />
		<mkdir dir="target/reports/png" />

		<svg-to-png srcFile="target/reports/svg/complexity-treemap.svg"
			destFile="target/reports/png/complexity-treemap.png" />
		<svg-to-png srcFile="target/reports/svg/coverage-treemap.svg"
			destFile="target/reports/png/coverage-treemap.png" />

		<svg-to-png srcFile="target/reports/svg/complexity-treemap.svg"
			destFile="target/reports/png/complexity-treemap-thumb.png"
			width="128"
			height="96"/>
		<svg-to-png srcFile="target/reports/svg/coverage-treemap.svg"
			destFile="target/reports/png/coverage-treemap-thumb.png"
			width="128"
			height="96"/>
	</target>

	<target name="rasterize-jpeg-reports">
		<delete dir="target/reports/jpeg" />
		<mkdir dir="target/reports/jpeg" />

		<svg-to-jpeg srcFile="target/reports/svg/complexity-treemap.svg"
			destFile="target/reports/jpeg/complexity-treemap.jpg" />
		<svg-to-jpeg srcFile="target/reports/svg/coverage-treemap.svg"
			destFile="target/reports/jpeg/coverage-treemap.jpg" />

		<svg-to-jpeg srcFile="target/reports/svg/complexity-treemap.svg"
			destFile="target/reports/jpeg/complexity-treemap-thumb.jpg"
			width="128"
			height="96"/>
		<svg-to-jpeg srcFile="target/reports/svg/coverage-treemap.svg"
			destFile="target/reports/jpeg/coverage-treemap-thumb.jpg"
			width="128"
			height="96"/>
	</target>

	<target name="rasterize-tiff-reports">
		<delete dir="target/reports/tiff" />
		<mkdir dir="target/reports/tiff" />

		<svg-to-tiff srcFile="target/reports/svg/complexity-treemap.svg"
			     destFile="target/reports/tiff/complexity-treemap.tif" />
		<svg-to-tiff srcFile="target/reports/svg/coverage-treemap.svg"
			     destFile="target/reports/tiff/coverage-treemap.tif" />

		<svg-to-tiff srcFile="target/reports/svg/complexity-treemap.svg"
			     destFile="target/reports/tiff/complexity-treemap-thumb.tif"
			     width="128"
			     height="96"/>
		<svg-to-tiff srcFile="target/reports/svg/coverage-treemap.svg"
			     destFile="target/reports/tiff/coverage-treemap-thumb.tif"
			     width="128"
			     height="96"/>
	</target>

	<copy file="/home/local/cruisecontrol/ccworkingdir/html/index.htm" todir="target">
		<filterset>
      			<filter token="project.name" value="${project.name}"/>
    		</filterset>
	</copy>

        <!-- clean up src.zip -->
        <delete dir="target/src" />
        <mkdir dir="target/src" /> 
	<copy todir="target/src">
		<fileset dir="${basedir}">
			<include name="*.zip"/>
		</fileset>
	</copy>
        <delete>
                <fileset dir="${basedir}">
                        <include name="*.zip"/>
                </fileset>
        </delete>

        <!-- clean up package.jar -->
        <delete dir="target/package" />
        <mkdir dir="target/package" />
        <copy todir="target/package">
                <fileset dir="${basedir}">
                        <include name="*.jar"/>
                </fileset>
        </copy>
        <delete>
                <fileset dir="${basedir}">
                        <include name="*.jar"/>
                </fileset>
        </delete>

        <!-- clean up javadocs -->
        <delete dir="target/docs/api" />
        <mkdir dir="target/docs/api" />

        <!-- generate javadoc -->
        <javadoc sourcepath="src"
                destdir="target/docs/api"
                classpathref="classpath"
                windowtitle="UML Modeling 2007"
                access="private"
                author="true"
                use="true"
                version="true"
                source="1.6">
                <fileset dir="src">
                        <include name="**.java"/>
                </fileset>
                <packageset dir="src" defaultexcludes="yes">
                        <include name="**"/>
                </packageset>
                <tag name="todo" scope="all" description="To do:"/>
                <tag name="Override" scope="all" description="Override:"/>
                <doctitle>
                        <![CDATA[<h1>UML Modeling 2007</h1><h2>Practical Laboratory Course at the winter term 2007/08</h2><h3>Test Project <i>HelloWorld</i></h3>]]>
                </doctitle>
                <bottom>
                        <![CDATA[<i>Copyright &#169; 2008 - Real-Time and Embedded Systems Group at Christian-Albrechts-University of Kiel - All Rights Reserved.</i>]]>
                </bottom>
        </javadoc>


</project>
